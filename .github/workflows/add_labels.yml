name: æ–°å¢æˆ–æ›´æ–° Labels

on:
  workflow_dispatch: # å…è¨±æ‰‹å‹•è§¸ç™¼

permissions:
  contents: write
  issues: write

jobs:
  add-labels:
    runs-on: ubuntu-latest
    steps:
      - name: ä½¿ç”¨ GitHub API æ–°å¢æˆ–æ›´æ–° Labels
        run: |
          LABELS=(
            '{"name": "feature", "color": "dac387", "description": "New Feature Request"}'
            '{"name": "duplicate", "color": "cfd3d7", "description": "This issue or pull request already exists"}'
          )

          echo "======= Adding or updating labels to ${{ github.repository }} ======="

          for LABEL in "${LABELS[@]}"; do
            LABEL_NAME=$(echo $LABEL | jq -r '.name')
            LABEL_COLOR=$(echo $LABEL | jq -r '.color')
            LABEL_DESCRIPTION=$(echo $LABEL | jq -r '.description')

            # æª¢æŸ¥æ¨™ç±¤æ˜¯å¦å­˜åœ¨
            response=$(curl -s -o /dev/null -w "%{http_code}" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/repos/${{ github.repository }}/labels/$LABEL_NAME)

            if [ "$response" -eq 200 ]; then
              echo "ğŸ”„ Label '$LABEL_NAME' exists, updating..."
              # æ›´æ–°æ¨™ç±¤
              curl -X PATCH \
                -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                -H "Accept: application/vnd.github.v3+json" \
                -d '{"color": "'"$LABEL_COLOR"'", "description": "'"$LABEL_DESCRIPTION"'"}' \
                https://api.github.com/repos/${{ github.repository }}/labels/$LABEL_NAME
            elif [ "$response" -eq 404 ]; then
              echo "ğŸ› ï¸ Label '$LABEL_NAME' does not exist, creating..."
              # å‰µå»ºæ¨™ç±¤
              curl -X POST \
                -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                -H "Accept: application/vnd.github.v3+json" \
                -d "$LABEL" \
                https://api.github.com/repos/${{ github.repository }}/labels
            else
              echo "ğŸ›‘ Error: Unexpected response $response for label '$LABEL_NAME'"
            fi
          done
