name: Êñ∞Â¢ûÊàñÊõ¥Êñ∞ Labels

on:
  workflow_dispatch: # ÂÖÅË®±ÊâãÂãïËß∏Áôº

permissions:
  contents: write
  issues: write

jobs:
  add-labels:
    runs-on: ubuntu-latest
    steps:
      - name: ‰ΩøÁî® GitHub API Êñ∞Â¢ûÊàñÊõ¥Êñ∞ Labels
        run: |
          LABELS=(
            '{"name": "bug", "color": "d73a4a", "description": "Something isn't working"}'
            '{"name": "documentation", "color": "0075ca", "description": "Improvements or additions to documentation"}'
            '{"name": "duplicate", "color": "cfd3d7", "description": "This issue or pull request already exists"}'
            '{"name": "enhancement", "color": "a2eeef", "description": "Feature or improvement to enhance functionality"}'
            '{"name": "feature", "color": "dac387", "description": "New Feature Request"}'
            '{"name": "good first issue", "color": "7057ff", "description": "Good for newcomers"}'
            '{"name": "help wanted", "color": "008672", "description": "Extra attention is needed"}'
            '{"name": "invalid", "color": "e4e669", "description": "This doesn't seem right"}'
            '{"name": "question", "color": "d876e3", "description": "Further information is requested"}'
            '{"name": "testing", "color": "f9d0c4", "description": "Marks features for testing"}'
            '{"name": "wip", "color": "f4a261", "description": "Work in Progress"}'
            '{"name": "wontfix", "color": "ffffff", "description": "This will not be worked on"}'
          )

          echo "======= Adding or updating labels to ${{ github.repository }} ======="

          for LABEL in "${LABELS[@]}"; do
            LABEL_NAME=$(echo $LABEL | jq -r '.name')
            LABEL_COLOR=$(echo $LABEL | jq -r '.color')
            LABEL_DESCRIPTION=$(echo $LABEL | jq -r '.description')

            # Ê™¢Êü•Ê®ôÁ±§ÊòØÂê¶Â≠òÂú®
            response=$(curl -s -o /dev/null -w "%{http_code}" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/repos/${{ github.repository }}/labels/$LABEL_NAME)

            if [ "$response" -eq 200 ]; then
              echo "üîÑ Label '$LABEL_NAME' exists, updating..."
              # Êõ¥Êñ∞Ê®ôÁ±§
              curl -X PATCH \
                -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                -H "Accept: application/vnd.github.v3+json" \
                -d '{"color": "'"$LABEL_COLOR"'", "description": "'"$LABEL_DESCRIPTION"'"}' \
                https://api.github.com/repos/${{ github.repository }}/labels/$LABEL_NAME
            elif [ "$response" -eq 404 ]; then
              echo "üõ†Ô∏è Label '$LABEL_NAME' does not exist, creating..."
              # ÂâµÂª∫Ê®ôÁ±§
              curl -X POST \
                -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                -H "Accept: application/vnd.github.v3+json" \
                -d "$LABEL" \
                https://api.github.com/repos/${{ github.repository }}/labels
            else
              echo "üõë Error: Unexpected response $response for label '$LABEL_NAME'"
            fi
          done
